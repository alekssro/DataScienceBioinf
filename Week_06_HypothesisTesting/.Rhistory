library(tidyverse)
d = read_delim(file="1000g.allele.frequencies.tsv.gz",delim=c("\t"))
d = d %>%
filter(population=="EUR") %>%
mutate(maf=ifelse(frequency>0.5, 1-frequency, frequency)) %>%
filter(maf > 0) %>%
mutate(population=factor(population),
reference_allele=factor(reference_allele),
alternative_allele=factor(alternative_allele))
d = read_delim(file="1000g.allele.frequencies.tsv.gz",delim=c("\t"))
d = d %>%
filter(population=="EUR") %>%
mutate(maf=ifelse(frequency>0.5, 1-frequency, frequency)) %>%
filter(maf > 0) %>%
mutate(population=factor(population),
reference_allele=factor(reference_allele),
alternative_allele=factor(alternative_allele))
summary(d)
names(d)
d %>% head(3)
d = d %>%
mutate(bin25k = position %/% 25000) %>%
ungroup()
d = d %>%
mutate(bin25k = position %/% 25000) %>%
ungroup()
library(tidyverse)
d = read_delim(file="1000g.allele.frequencies.tsv.gz",delim=c("\t"))
d = d %>%
filter(population=="EUR") %>%
mutate(maf=ifelse(frequency>0.5, 1-frequency, frequency)) %>%
filter(maf > 0) %>%
mutate(population=factor(population),
reference_allele=factor(reference_allele),
alternative_allele=factor(alternative_allele))
summary(d)
d = d %>%
mutate(bin25k = position %/% 25000) %>%
ungroup()
br = d %>%
group_by(bin25k) %>%
summarize(n20 = sum(maf>0.2),
n   = n(),
ts  = n20/n,
x = (min(position)+max(position))/2) %>%
ungroup()
d = read_delim(file="1000g.allele.frequencies.tsv.gz",delim=c("\t"))
d = d %>%
mutate(bin25k = position %/% 25000) %>%
ungroup()
names(d)
d %>% head(3)
d = read_delim(file="1000g.allele.frequencies.tsv.gz",delim=c("\t"))
d = d %>%
filter(population=="EUR") %>%
mutate(maf=ifelse(frequency>0.5, 1-frequency, frequency)) %>%
filter(maf > 0) %>%
mutate(population=factor(population),
reference_allele=factor(reference_allele),
alternative_allele=factor(alternative_allele))
summary(d)
d = d %>%
mutate(bin25k = position %/% 25000) %>%
ungroup()
names(d)
d %>% head(3)
br = d %>%
group_by(bin25k) %>%
summarize(n20 = sum(maf>0.2),
n   = n(),
ts  = n20/n,
x = (min(position)+max(position))/2) %>%
ungroup()
names(br)
br %>% head(5)
pd = br %>% arrange(n)
plot1 = ggplot(data = pd, aes(x=x, y=ts, color=n, size=n)) +
geom_point() +
scale_color_gradientn(colours = parula_colors)+
nature_theme()
plot1 = ggplot(data = pd, aes(x=x, y=ts, color=n, size=n)) +
geom_point()  #+
ggsave(filename = "chromosome.plot.png", plot = plot1, width=100, height=60, units = "mm", dpi=300)
plot1
d %>% summarise(n=n(), n20 = sum(maf > 0.2), p20 = n20/n)
br %>% head(5)
?rbinom
d %>% summary
d %>% head(5)
d %>% group_by(bin25k) %>% head(5)
br %>% head
br %>% summary
xbar = br %>% mean(ts)
br %>% mean(ts)
mean(br$ts)
sum(br$n)
n = sum(br$n)                 # sample size
z = (xbar−mu0)/(sigma/sqrt(n))
mu0 = 0.1583499         # hypothesized value
xbar = mean(br$ts)      # population mean
sigma = sd(br$ts)       # population standard deviation
n = sum(br$n)                 # sample size
z = (xbar−mu0)/(sigma/sqrt(n))
z                      # test statistic
dbinom(c(0, 0.5), sum(br$n), 0.5)
dbinom(c(0, 0.5), size = sum(br$n), 0.5)
dbinom(0.5, size = sum(br$n), 0.5)
z.half.alpha = qbinom(1−alpha/2)
alpha = .05
z.half.alpha = qbinom(1−alpha/2)
c(−z.half.alpha, z.half.alpha)
z.half.alpha = qbinom(1−alpha/2, size = sum(br$n))
z.half.alpha = qbinom(1−alpha/2, size = sum(br$n), prob = 0.5)
c(−z.half.alpha, z.half.alpha)
−1.9600  1.9600
P <- 2 * (sum(d$maf > 0.2))
P
br %>% head(5)
?distinct
plot1
binom.test(c(2706, 4124), n=sum(br$n), p=0.1583499)
br %>%
ungroup() %>%
rowwise() %>%
mutate(p = sum(dbinom(n20:n, n, prob = 0.1583499))
br
br %>%
ungroup() %>%
rowwise() %>%
mutate(p = sum(dbinom(n20:n, n, prob = 0.1583499)))
br %>%
ungroup() %>%
rowwise() %>%
mutate(p = sum(dbinom(n20:n, n, prob = 0.1583499)),
p2 = pbinom(n20-1, size = n, prob = 0.1583499, lower.tail = F))
binom.test <- br %>%
ungroup() %>%
rowwise() %>%
mutate(p = sum(dbinom(n20:n, n, prob = 0.1583499)),
p2 = pbinom(n20-1, size = n, prob = 0.1583499, lower.tail = F))
binom.test
binom.test %>%
arrange(p) %>%
head(10)
binom.test %>%
select(p) %>%
min()
binom.test %>%
filter(p < 0.001) %>%
n()
binom.test %>%
filter(p < 0.001) %>%
nrow()
nrow(br) * 0.001
ggplot(br, aes(bin25k, -log(p))) +
geom_point()
ggplot(binom.test, aes(bin25k, p)) +
geom_point()
ggplot(binom.test, aes(bin25k, -log(p))) +
geom_point()
binom <- br %>%
ungroup() %>%
rowwise() %>%
mutate(p = sum(dbinom(n20:n, n, prob = 0.1583499)),
p2 = pbinom(n20-1, size = n, prob = 0.1583499, lower.tail = F))
binom %>%
arrange(p) %>%
head(10)
binom %>%
select(p) %>%
min()
binom %>%
filter(p < 0.001) %>%
nrow()
nrow(br) * 0.001
ggplot(binom, aes(bin25k, p)) +
geom_point()
head(d)
binom <- br %>%
ungroup() %>%
rowwise() %>%
mutate(p = sum(dbinom(n20:n, n, prob = 0.1583499)),
p2 = pbinom(n20-1, size = n, prob = 0.1583499, lower.tail = F))
pd = br %>% arrange(n)
plot1 = ggplot(data = pd, aes(x=x, y=ts, color=n, size=n)) +
geom_point()  #+
#scale_color_gradientn(colours = parula_colors)+
#nature_theme()
ggsave(filename = "chromosome.plot.png", plot = plot1, width=100, height=60, units = "mm", dpi=300)
plot1
nrow(br) * 0.001
nrow(br) < 0.001
nrow(br) * 0.001
ggplot(binom, aes(bin25k, p)) +
geom_point()
ggplot(binom.test, aes(bin25k, -log(p))) +
geom_point()
pd = br %>% arrange(n)
plot1 = ggplot(data = pd, aes(x=x, y=ts, color=n, size=n)) +
geom_point()  #+
#scale_color_gradientn(colours = parula_colors)+
#nature_theme()
ggsave(filename = "chromosome.plot.png", plot = plot1, width=100, height=60, units = "mm", dpi=300)
plot1
head(d)
d %>% arrange(position)
d %>% max(position)
d %>% arrange(position) %>% tail(1)
hist(d$position)
hist(d$position)
?hist
d = d %>%
mutate(bin25k = position %/% 25000) %>%
ungroup()
d %>% summarise(n=n(), n20 = sum(maf > 0.2), p20 = n20/n)
d %>% summarise(n=n(), n20 = sum(maf > 0.2), p20 = n20/n) %>% select(p20)
d %>% summarise(n=n(), n20 = sum(maf > 0.2), p20 = n20/n) %>% select(p20) %>% int
d %>% summarise(n=n(), n20 = sum(maf > 0.2), p20 = n20/n) %>% select(p20) %>% int()
prob20 <- d %>% summarise(n=n(), n20 = sum(maf > 0.2), p20 = n20/n)
prob20[1, 3]
prob20[[1, 3]]
prob20<- prob20[[1, 3]]
binom <- br %>%
ungroup() %>%
rowwise() %>%
mutate(p = sum(dbinom(n20:n, n, prob = prob20)),
p2 = pbinom(n20-1, size = n, prob = prob20, lower.tail = F))
binom %>%
arrange(p) %>%
head(10)
binom %>%
select(p) %>%
min()
binom %>%
filter(p < 0.001) %>%
nrow()
nrow(br) * 0.001
ggplot(binom, aes(bin25k, p)) +
geom_point()
ggplot(binom.test, aes(bin25k, -log(p))) +
geom_point()
d %>%
arrange(position) %>%
mutate(SNPnumber = row_number())
d = d %>%
mutate(bin500snps = SNPnumber %/% 500) %>%
ungroup()
d %>%
arrange(position) %>%
mutate(SNPnumber = row_number())
d = d %>%
mutate(bin500snps = SNPnumber %/% 500) %>%
ungroup()
d = d %>%
ungroup() %>%
mutate(bin500snps = SNPnumber %/% 500) %>%
ungroup()
d = d %>%
arrange(position) %>%
mutate(SNPnumber = row_number())
d %>%
ungroup() %>%
mutate(bin500snps = SNPnumber %/% 500) %>%
ungroup()
summary(d)
d = d %>%
arrange(position) %>%
mutate(SNPnumber = row_number())
d = d %>%
ungroup() %>%
mutate(bin500snps = SNPnumber %/% 500) %>%
ungroup()
summary(d)
d = d %>%
arrange(position) %>%
mutate(SNPnumber = row_number())
binned_results_500 <- d %>%
mutate(bin500snps = SNPnumber %/% 500) %>%
group_by(bin500snps) %>%
summarize(n20 = sum(maf>0.2),
n   = n(),
ts  = n20/n,
x = (min(position)+max(position))/2) %>%
ungroup()
binned_results_500
binned_results_500 <- d %>%
mutate(bin500snps = (SNPnumber-1) %/% 500) %>%
group_by(bin500snps) %>%
summarize(n20 = sum(maf>0.2),
n   = n(),
ts  = n20/n,
x = (min(position)+max(position))/2) %>%
ungroup()
binned_results_500
prob20 <- binned_results_500 %>% summarise(n=n(), n20 = sum(maf > 0.2), p20 = n20/n)
prob20<- prob20[[1, 3]]
prob20
binned_results_500 <- d %>%
mutate(bin500snps = (SNPnumber-1) %/% 500) %>%
group_by(bin500snps) %>%
summarize(n20 = sum(maf>0.2),
n   = n(),
ts  = n20/n,
x = (min(position)+max(position))/2) %>%
ungroup()
prob20 <- binned_results_500 %>% summarise(n=n(), n20 = sum(maf > 0.2), p20 = n20/n)
d = d %>%
arrange(position) %>%
mutate(SNPnumber = row_number(), bin500snps = (SNPnumber-1) %/% 500)
d
d <- d %>%
group_by(bin500snps) %>%
summarize(n20 = sum(maf>0.2),
n   = n(),
ts  = n20/n,
x = (min(position)+max(position))/2) %>%
ungroup()
prob20 <- binned_results_500 %>% summarise(n=n(), n20 = sum(maf > 0.2), p20 = n20/n)
binned_results_500 <- d %>%
group_by(bin500snps) %>%
summarize(n20 = sum(maf>0.2),
n   = n(),
ts  = n20/n,
x = (min(position)+max(position))/2) %>%
ungroup()
d = d %>%
arrange(position) %>%
mutate(SNPnumber = row_number(), bin500snps = (SNPnumber-1) %/% 500)
d
